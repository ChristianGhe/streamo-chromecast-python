<!DOCTYPE html>
<html>
<head>
    <title>Video Streaming</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
<select id="videoSelect" onchange="loadVideo()"></select>
<video id="videoPlayer" controls></video>

<script>
        var data;
        var hls;

        // Fetch the JSON data from the API
        fetch('/video_list.json')
            .then(response => response.json())
            .then(jsonData => {
                data = jsonData;

                // Get the select element
                var videoSelect = document.getElementById('videoSelect');

                // Add an option to the select for each video
                data.categories[0].videos.forEach((video, index) => {
                    var option = document.createElement('option');
                    option.value = index;
                    option.text = video.title;
                    videoSelect.add(option);
                });

                // Load the first video
                loadVideo();
            });

        function loadVideo() {
            // Get the selected video
            var videoSelect = document.getElementById('videoSelect');
            var videoIndex = videoSelect.value;
            var video = data.categories[0].videos[videoIndex];
            var source = video.sources.find(source => source.type === 'hls');

            // Create the full URL for the HLS stream
            var hlsUrl = data.categories[0].hls + source.url;

            // Set up hls.js
            if (Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(hlsUrl);
                hls.attachMedia(videoPlayer);
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    videoPlayer.play();
                });
            }
            // For browsers that do not support hls.js
            else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                videoPlayer.src = hlsUrl;
                videoPlayer.addEventListener('loadedmetadata', function() {
                    videoPlayer.play();
                });
            }
        }
    </script>
</body>
</html>
